<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ìƒì¼ ì¶•í•˜í•©ë‹ˆë‹¤!</title>
    <!-- í•œê¸€ í°íŠ¸ ì¶”ê°€ -->
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic&display=swap" rel="stylesheet">
    <style>
        @font-face {
            font-family: 'Nanum GarMaesGeur';
            src: url('./font.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }
        body { margin: 0; overflow: hidden; background-color: black; }
        canvas {
            display: block;
            position: relative;
            z-index: 1;
        }

        /* í¸ì§€ ë´‰íˆ¬ ìŠ¤íƒ€ì¼ */
        .envelope-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            opacity: 0;
            transition: opacity 2s ease;
            display: none;
        }

        .envelope {
            position: relative;
            width: 300px;
            height: 200px;
            background: #87CEFA;
            border: 1px solid #00BFFF; /* ë”¥ ìŠ¤ì¹´ì´ ë¸”ë£¨ */
            box-shadow: 0px 8px 15px rgba(0, 0, 0, 0.2);
            border-radius: 4px;
            transition: transform 3s ease, opacity 0.5s ease;
            cursor: pointer;
            z-index: 5;
            background-image: repeating-linear-gradient(
                45deg,
                rgba(255, 255, 255, 0.2) 0px,
                rgba(255, 255, 255, 0.2) 2px,
                transparent 2px,
                transparent 4px
            );
        }

        .flap {
            position: absolute;
            top: 1px;
            left: 5px;
            width: 96%;
            height: 50%;
            background: #00BFFF; /* ë” ì§„í•œ í•˜ëŠ˜ìƒ‰ìœ¼ë¡œ */
            clip-path: polygon(0 0, 50% 100%, 100% 0);
            transition: transform 3s ease, opacity 0.2s ease;
            transform-origin: top center;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.15);
            z-index: 40;
        }

        .base-envelope {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 300px;
            height: 200px;
            background: #87CEFA; /* í•˜ëŠ˜ìƒ‰ */
            clip-path: polygon(0 0, 10% 0, 50% 43%, 90% 0, 100% 0, 100% 100%, 0% 100%);
            transform: translate(-50%, -50%);
            transition: transform 3s ease, opacity 0.5s ease;
            border-radius: 4px;
            z-index: 20;
            background-image: repeating-linear-gradient(
                45deg,
                rgba(255, 255, 255, 0.2) 0px,
                rgba(255, 255, 255, 0.2) 2px,
                transparent 2px,
                transparent 4px
            );
        }

        .letter {
            position: relative;
            position: absolute;
            top: 2px;
            left: 50%;
            width: 260px;
            height: 150px;
            background: #ffffff; /* í°ìƒ‰ */
            border: 2px solid #e5e5e5;
            transform: translate(-50%, 0);
            transition: opacity 1s ease, transform 0.7s ease, height 1.3s ease;
            border-radius: 5px;
            box-shadow: 0px 8px 15px rgba(0, 0, 0, 0.1);
            z-index: 10;
            background-image: url('./paper-texture.png'); /* ì¢…ì´ ì§ˆê° */
            background-size: cover;
            background-repeat: no-repeat;
        }

        /* ê·¸ë¼ë°ì´ì…˜ ì˜¤ë²„ë ˆì´ ì¶”ê°€ */
        .letter::before,
        .letter::after {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            height: 30px;
            pointer-events: none;
            z-index: 2;
        }

        .letter::before {
            top: 0;
            background: linear-gradient(to bottom, rgba(255, 255, 255, 1), rgba(255, 255, 255, 0));
        }

        .letter::after {
            bottom: 0;
            background: linear-gradient(to top, rgba(255, 255, 255, 1), rgba(255, 255, 255, 0));
        }

        .letter-content {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            <!-- font-family: 'Cormorant Garamond', serif; -->
            font-size: 0.6em;
            color: #333;
            opacity: 0;
            transition: opacity 1s ease;
            white-space: pre-wrap;
            overflow-y: auto;
            scrollbar-width: none; /* Firefox */
            background: transparent;
            padding: 20px;
            text-align: left;
        }

        .letter-content::-webkit-scrollbar {
            display: none;
        }

        .letter-content::before {
            top: 0;
            background: linear-gradient(to bottom, #e6f7ff, transparent);
        }

        .letter-content::after {
            bottom: 0;
            background: linear-gradient(to top, #e6f7ff, transparent);
        }


        .letter.open {
            height: 380px;
            transform: translate(-50%, -50%);
            opacity: 1;
            z-index: 10;
            overflow: hidden;
        }
        .letter-content.visible {
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- í­ì£½ ìº”ë²„ìŠ¤ -->
    <canvas id="canvas"></canvas>
    <!-- í¸ì§€ ë´‰íˆ¬ ì»¨í…Œì´ë„ˆ -->
    <div class="envelope-container" id="container">
        <div class="flap" id="flap"></div>
        <div class="base-envelope" id="base-envelope"></div>
        <div class="envelope" id="envelope"></div>
        <div class="letter" id="letter">
            <div class="letter-content" id="letter-content">
                <p id="typed-text"></p>
            </div>
        </div>
    </div>
    <!-- ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
        // ìº”ë²„ìŠ¤ ì´ˆê¸° ì„¤ì •
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let w = canvas.width = window.innerWidth;
        let h = canvas.height = window.innerHeight;

        // ì…ì ë° í­ì£½ ê´€ë ¨ ë³€ìˆ˜
        let particles = [];
        let explosionParticles = [];
        let fireworks = [];
        let textPixels = [];
        let fireworkY = h;
        let fireworkLaunched = false;
        let textAnimationDone = false;
        let timer = 0;
        let envelopeShown = false;

        // ì´ˆê¸°í™”
        function init() {
            w = canvas.width = window.innerWidth;
            h = canvas.height = window.innerHeight;
            fireworkY = h;
            particles = [];
            fireworks = [];
            textPixels = [];
            fireworkLaunched = false;
            textAnimationDone = false;
            envelopeShown = false;

            // í°íŠ¸ ë¡œë”© í›„ í…ìŠ¤íŠ¸ í”½ì…€ ìƒì„±
            document.fonts.ready.then(function() {
                generateTextPixels();
            });
        }

        // í…ìŠ¤íŠ¸ í”½ì…€ ìƒì„±
        function generateTextPixels() {
            const textCanvas = document.createElement('canvas');
            const textCtx = textCanvas.getContext('2d');
            textCanvas.width = w;
            textCanvas.height = h;

            const message = 'ìƒì¼ ì¶•í•˜í•´ ëª…ì§€ì•¼';

            // í°íŠ¸ í¬ê¸°ë¥¼ ë™ì ìœ¼ë¡œ ê³„ì‚°
            let fontSize = 120; // ì‹œì‘ í°íŠ¸ í¬ê¸°
            textCtx.font = `bold ${fontSize}px Nanum Gothic`;

            // í…ìŠ¤íŠ¸ì˜ ë„ˆë¹„
            let textWidth = textCtx.measureText(message).width;

            // í™”ë©´ ë„ˆë¹„ì˜ 90%ë¥¼ ë„˜ì§€ ì•Šë„ë¡ í°íŠ¸ í¬ê¸°ë¥¼ ì¡°ì ˆ
            while (textWidth > w * 0.9) {
                fontSize -= 2;
                textCtx.font = `bold ${fontSize}px Nanum Gothic`;
                textWidth = textCtx.measureText(message).width;
            }

            // í…ìŠ¤íŠ¸ë¥¼ ì¤‘ì•™ì— ê·¸ë¦¬ê¸°
            textCtx.fillStyle = 'white';
            textCtx.textAlign = 'center';
            textCtx.textBaseline = 'middle';
            textCtx.fillText(message, w / 2, h / 2);

            const imageData = textCtx.getImageData(0, 0, w, h);
            const data = imageData.data;

            // ê¸°ì¡´ì˜ textPixels ì´ˆê¸°í™”
            textPixels = [];

            for (let y = 0; y < h; y += 3) {
                for (let x = 0; x < w; x += 3) {
                    const index = (y * w + x) * 4;
                    if (data[index + 3] > 128) {
                        textPixels.push({ x: x, y: y });
                    }
                }
            }
        }

        let eFlag = 0;
        let tempLength = 0;
        let fireworkLaunchDelay = 2500; // ì§€ì—° ì‹œê°„
        let fireworkStartTime = null;    // í­ì£½ ë°œì‚¬ ì‹œì‘ ì‹œê°„

        // ì• ë‹ˆë©”ì´ì…˜ ë£¨í”„
        function animate(timestamp) {
            ctx.clearRect(0, 0, w, h);

            // ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘ ì‹œê°„ì„ ì €ì¥
            if (!fireworkStartTime) {
                fireworkStartTime = timestamp;
            }

            // í˜„ì¬ ê²½ê³¼ ì‹œê°„ ê³„ì‚°
            let elapsed = timestamp - fireworkStartTime;

            // ì§€ì—° ì‹œê°„ì´ ì§€ë‚˜ì§€ ì•Šì€ ê²½ìš°
            if (elapsed < fireworkLaunchDelay) {
            }
            // í­ì£½ ë°œì‚¬
            else if (!fireworkLaunched) {
                drawFirework();
                fireworkY -= 10;
                if (fireworkY < h / 2) {
                    fireworkLaunched = true;
                    createParticles();
                }
            }
            // í…ìŠ¤íŠ¸ ì…ì ì• ë‹ˆë©”ì´ì…˜
            else if (!textAnimationDone && eFlag > -1) {
                updateParticles();
                if ( tempLength > particles.length) {
                    eFlag = 1;
                }
                tempLength = particles.length;
                if (particles.length == 0 || eFlag == 1) {
                    // textAnimationDone = true;

                    // í…ìŠ¤íŠ¸ ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ í›„ 3ì´ˆ ë’¤ì— í¸ì§€ ë´‰íˆ¬ í‘œì‹œ
                    setTimeout(showEnvelope, 500);
                }
            }

            // ì§€ì†ì ì¸ í­ì£½ ë°œì‚¬
            createRandomFireworks();

            // í­ë°œ ì…ì ì—…ë°ì´íŠ¸ ë° ê·¸ë¦¬ê¸°
            updateExplosionParticles();

            requestAnimationFrame(animate);
        }

        // ì´ˆê¸° í­ì£½ ê·¸ë¦¬ê¸°
        function drawFirework() {
            if (eFlag == -1) return;
            ctx.save();

            let centerX = w / 2;
            let centerY = fireworkY;

            // ë¸”ë Œë”© ëª¨ë“œ ì„¤ì •
            ctx.globalCompositeOperation = 'lighter';

            // ì²« ë²ˆì§¸ ê´‘ì› ë ˆì´ì–´ (ë„“ì€ ë²”ìœ„)
            let gradientRadius1 = 160;
            let gradient1 = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, gradientRadius1);
            gradient1.addColorStop(0, 'rgba(255, 255, 255, 0.2)');
            gradient1.addColorStop(1, 'rgba(255, 255, 255, 0)');
            ctx.fillStyle = gradient1;
            ctx.beginPath();
            ctx.arc(centerX, centerY, gradientRadius1, 0, Math.PI * 2);
            ctx.fill();

            // ë‘ ë²ˆì§¸ ê´‘ì› ë ˆì´ì–´ (ì¤‘ê°„ ë²”ìœ„)
            let gradientRadius2 = 80;
            let gradient2 = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, gradientRadius2);
            gradient2.addColorStop(0, 'rgba(255, 255, 255, 0.5)');
            gradient2.addColorStop(1, 'rgba(255, 255, 255, 0)');
            ctx.fillStyle = gradient2;
            ctx.beginPath();
            ctx.arc(centerX, centerY, gradientRadius2, 0, Math.PI * 2);
            ctx.fill();

            // ì„¸ ë²ˆì§¸ ê´‘ì› ë ˆì´ì–´ (ì‘ì€ ë²”ìœ„)
            let gradientRadius3 = 30;
            let gradient3 = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, gradientRadius3);
            gradient3.addColorStop(0, 'rgba(255, 255, 255, 1)');
            gradient3.addColorStop(1, 'rgba(255, 255, 255, 0)');
            ctx.fillStyle = gradient3;
            ctx.beginPath();
            ctx.arc(centerX, centerY, gradientRadius3, 0, Math.PI * 2);
            ctx.fill();

            // ê·¸ë¦¼ì íš¨ê³¼ ì„¤ì • (ì¶”ê°€ ê´‘ì› íš¨ê³¼)
            ctx.shadowBlur = 100;
            ctx.shadowColor = 'rgba(255, 255, 255, 1)';

            // ì¤‘ì•™ì˜ ì› ê·¸ë¦¬ê¸° (í•µì‹¬ ë¶€ë¶„)
            ctx.fillStyle = 'rgba(255, 255, 255, 1)';
            ctx.beginPath();
            ctx.arc(centerX, centerY, 30, 0, Math.PI * 2);
            ctx.fill();

            // ë¸”ë Œë”© ëª¨ë“œ ì›ë˜ëŒ€ë¡œ ë³µì›
            ctx.globalCompositeOperation = 'source-over';

            ctx.restore();
        }



        // ë³„ ê·¸ë¦¬ê¸°
        function drawStar(ctx, x, y, outerRadius, innerRadius, points) {
            ctx.beginPath();
            let angle = Math.PI / points;

            for (let i = 0; i < 2 * points; i++) {
                let r = (i % 2 === 0) ? outerRadius : innerRadius;
                let currX = x + Math.cos(i * angle - Math.PI / 2) * r;
                let currY = y + Math.sin(i * angle - Math.PI / 2) * r;
                if (i === 0) {
                    ctx.moveTo(currX, currY);
                } else {
                    ctx.lineTo(currX, currY);
                }
            }
            ctx.closePath();
        }



        // ì…ì ìƒì„±
        function createParticles() {
            for (let i = 0; i < textPixels.length; i++) {
                const p = textPixels[i];
                particles.push({
                    x: w / 2,
                    y: fireworkY,
                    dx: p.x + (Math.random() - 0.5) * 10,
                    dy: p.y + (Math.random() - 0.5) * 10,
                    vx: 0,
                    vy: 0,
                    alpha: 1,
                    delay: Math.random() * 50,
                    blinkOffset: Math.random() * Math.PI * 2
                });
            }
        }

        let particleSpeedFactor = 0.01; // ì…ì ì´ë™ ì†ë„
        // ì…ì ì—…ë°ì´íŠ¸
        function updateParticles() {
            const currentTime = performance.now();
            let allParticlesReached = true; // ëª¨ë“  ì…ìê°€ ëª©í‘œ ìœ„ì¹˜ì— ë„ë‹¬í–ˆëŠ”ì§€ í™•ì¸

            particles.forEach((p, index) => {
                if (p.delay > 0) {
                    p.delay--;
                    allParticlesReached = false;
                } else {
                    // ëª©í‘œ ìœ„ì¹˜ì— ë„ë‹¬í•˜ì§€ ì•Šì€ ê²½ìš°ì—ë§Œ ì—…ë°ì´íŠ¸
                    if (!p.reachedDestination) {
                        // ëª©í‘œ ìœ„ì¹˜ë¡œ ì´ë™
                        p.vx += (p.dx - p.x) * particleSpeedFactor;
                        p.vy += (p.dy - p.y) * particleSpeedFactor;
                        p.vx *= 0.9; // 0.8
                        p.vy *= 0.9; // 0.8
                        p.x += p.vx;
                        p.y += p.vy;

                        // ì…ìê°€ ëª©í‘œ ìœ„ì¹˜ì— ë„ë‹¬í–ˆëŠ”ì§€ í™•ì¸
                        if (Math.abs(p.dx - p.x) < 0.5 && Math.abs(p.dy - p.y) < 0.5) {
                            p.x = p.dx;
                            p.y = p.dy;
                            p.vx = 0;
                            p.vy = 0;
                            p.reachedDestination = true;
                            p.arrivalTime = currentTime; // ë„ì°© ì‹œê°„ ì €ì¥
                            p.alpha = 1; // í˜ì´ë“œì•„ì›ƒì„ ìœ„í•œ alpha ê°’ ì´ˆê¸°í™”
                        } else {
                            allParticlesReached = false;
                        }
                    } else {
                        // ì…ìê°€ ëª©í‘œ ìœ„ì¹˜ì— ë„ë‹¬í•œ í›„ 3ì´ˆ ë™ì•ˆ ìœ ì§€
                        let timeSinceArrival = currentTime - p.arrivalTime;
                        if (timeSinceArrival >= 3000) { // í˜ì´ë“œì•„ì›ƒ ì‹œì‘ ì†ë„
                            p.alpha -= 0.01; // í˜ì´ë“œì•„ì›ƒ ì†ë„ ì¡°ì ˆ
                            if (p.alpha <= 0) {
                                p.alpha = 0;
                            }
                        }
                    }

                    // ë°˜ì§ì„ íš¨ê³¼ ì ìš©
                    const flicker = Math.abs(Math.sin((currentTime / 100) + p.blinkOffset));

                    // ìƒ‰ìƒ ë³€ê²½
                    const hue = (currentTime / 20) % 360;
                    const color = `hsla(${hue}, 100%, 75%, ${p.alpha * flicker})`;

                    ctx.fillStyle = color;
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, 2, 0, Math.PI * 2);
                    ctx.fill();
                }
            });

            // ëª¨ë“  ì…ìê°€ ëª©í‘œ ìœ„ì¹˜ì— ë„ë‹¬í–ˆì„ ë•Œ
            if (allParticlesReached && !textAnimationDone) {
                // í…ìŠ¤íŠ¸ ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ í›„ 3ì´ˆ ë’¤ì— í¸ì§€ ë´‰íˆ¬ í‘œì‹œ
                setTimeout(() => {
                    // textAnimationDone = true;
                    showEnvelope();
                }, 3000);
            }

            // í˜ì´ë“œì•„ì›ƒì´ ì™„ë£Œëœ ì…ì ì œê±°
            particles = particles.filter(p => p.alpha > 0);

            // ì…ìë“¤ì´ ëª¨ë‘ ì œê±°ë˜ì—ˆì„ ë•Œ í¸ì§€ ë´‰íˆ¬ í‘œì‹œ
            if (particles.length === 0 && !envelopeShown) {
                showEnvelope();
                envelopeShown = true; // ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€
            }
        }

        // í¸ì§€ ë´‰íˆ¬ í‘œì‹œ í•¨ìˆ˜ ì¶”ê°€
        function showEnvelope() {
            if (!envelopeShown) {
                const container = document.getElementById('container');
                container.style.display = 'block';
                setTimeout(function() {
                    container.style.opacity = '1';
                    setTimeout(function() {
                        textAnimationDone = true;
                        eFlag = -1;
                    }, 800);
                }, 100);
                envelopeShown = true;
            }
        }


        // í­ì£½
        let limiterTotal = 5;
        let limiterTick = 0;

        function createRandomFireworks() {
            if (limiterTick >= limiterTotal) {
                const startX = Math.random() * w;
                const startY = h;

                const maxAngle = 20 * Math.PI / 180;
                const angle = (Math.random() - 0.5) * 2 * maxAngle;
                const distance = h / 2; // í™”ë©´ ë†’ì´ì˜ ì ˆë°˜ ì •ë„

                const targetX = startX + distance * Math.tan(angle);
                // const targetX = Math.random() * w;
                const targetY = Math.random() * h / 2;
                fireworks.push(new Firework(startX, startY, targetX, targetY));
                limiterTick = 0;
            } else {
                limiterTick++;
            }

            fireworks.forEach((fw, index) => {
                fw.update(index);
                fw.draw();
            });
        }

        // Firework í´ë˜ìŠ¤ ì •ì˜
        class Firework {
            constructor(sx, sy, tx, ty) {
                this.x = sx;
                this.y = sy;
                this.sx = sx;
                this.sy = sy;
                this.tx = tx;
                this.ty = ty;
                this.distanceToTarget = Math.hypot(tx - sx, ty - sy);
                this.distanceTraveled = 0;
                this.coordinates = [];
                this.coordinateCount = 3;
                while (this.coordinateCount--) {
                    this.coordinates.push([this.x, this.y]);
                }
                this.angle = Math.atan2(ty - sy, tx - sx);
                this.speed = 2;
                this.acceleration = 1.05;
                this.maxSpeed = 15; // ìµœëŒ€ ì†ë„
                this.brightness = Math.random() * 50 + 50;
                this.targetRadius = 1;
            }

            update(index) {
                this.coordinates.pop();
                this.coordinates.unshift([this.x, this.y]);

                if (this.targetRadius < 8) {
                    this.targetRadius += 0.3;
                } else {
                    this.targetRadius = 1;
                }

                this.speed *= this.acceleration;

                // ìµœëŒ€ ì†ë„ ì œí•œ ì ìš©
                if (this.speed > this.maxSpeed) {
                    this.speed = this.maxSpeed;
                }

                const vx = Math.cos(this.angle) * this.speed;
                const vy = Math.sin(this.angle) * this.speed;

                this.distanceTraveled = Math.hypot(this.x - this.sx, this.y - this.sy);

                if (this.distanceTraveled >= this.distanceToTarget) {
                    // console.log(`111`);
                    // console.log(`${this.tx} / ${this.ty}`);
                    createExplosion(this.tx, this.ty);
                    fireworks.splice(index, 1);
                } else {
                    this.x += vx;
                    this.y += vy;
                }
            }

            draw() {
                ctx.beginPath();
                ctx.moveTo(this.coordinates[this.coordinates.length - 1][0], this.coordinates[this.coordinates.length - 1][1]);
                ctx.lineTo(this.x, this.y);
                ctx.strokeStyle = `hsl(${Math.random() * 360}, 100%, ${this.brightness}%)`;
                ctx.stroke();

                ctx.beginPath();
                ctx.arc(this.tx, this.ty, this.targetRadius, 0, Math.PI * 2);
                ctx.stroke();
            }
        }

        // í­ì£½ í­ë°œ ì…ì ìƒì„±
        function createExplosion(x, y) {
            const particleCount = 40;
            for (let i = 0; i < particleCount; i++) {
                const angle = Math.random() * Math.PI * 2;
                const speed = Math.random() * 2;
                explosionParticles.push({
                    x: x,
                    y: y,
                    vx: Math.cos(angle) * speed,
                    vy: Math.sin(angle) * speed,
                    alpha: 1,
                    decay: Math.random() * 0.02 + 0.01
                });
            }
        }

        function updateExplosionParticles() {
            for (let i = explosionParticles.length - 1; i >= 0; i--) {
                const p = explosionParticles[i];
                p.x += p.vx;
                p.y += p.vy;
                p.alpha -= p.decay;
                if (p.alpha <= 0) {
                    explosionParticles.splice(i, 1);
                } else {
                    const randomColor = () => {
                        // ë³´ë¼ìƒ‰, í•˜ëŠ˜ìƒ‰, í°ìƒ‰ì„ ê¸°ë³¸ ìƒ‰ìƒìœ¼ë¡œ ì„¤ì •
                        const colors = [
                            { r: 128, g: 0, b: 128 },   // ë³´ë¼ìƒ‰
                            { r: 135, g: 206, b: 235 }, // í•˜ëŠ˜ìƒ‰
                            { r: 255, g: 255, b: 255 }  // í°ìƒ‰
                        ];

                        // ê¸°ë³¸ ìƒ‰ìƒ ì¤‘ í•˜ë‚˜ë¥¼ ëœë¤ìœ¼ë¡œ ì„ íƒ
                        const baseColor = colors[Math.floor(Math.random() * colors.length)];

                        // ì˜¤ì°¨ ë²”ìœ„ë¥¼ ì„¤ì •í•˜ì—¬ ì•½ê°„ì˜ ìƒ‰ìƒ ë³€í™”ë¥¼ ì¤Œ (ìµœëŒ€ Â±30 ë²”ìœ„ì—ì„œ ëœë¤)
                        const randomVariance = () => Math.floor(Math.random() * 61) - 30;

                        // ê°ê°ì˜ ìƒ‰ìƒ ê°’ì— ì˜¤ì°¨ ë²”ìœ„ë¥¼ ì ìš©í•˜ì—¬ ì•½ê°„ì˜ ë³€ë™ì„ ì¤Œ
                        const r = Math.max(0, Math.min(255, baseColor.r + randomVariance()));
                        const g = Math.max(0, Math.min(255, baseColor.g + randomVariance()));
                        const b = Math.max(0, Math.min(255, baseColor.b + randomVariance()));

                        return `rgba(${r}, ${g}, ${b}, ${p.alpha})`;
                    };
                    ctx.fillStyle = randomColor();
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, 2, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
        }



        window.onload = function() {
            init();
            requestAnimationFrame(animate);
        };
        window.onresize = init;

        // í¸ì§€ ë´‰íˆ¬ ì¸í„°ë™ì…˜
        const envelope_container = document.getElementById('container');
        const envelope = document.getElementById('envelope');
        const base_envelope = document.getElementById('base-envelope');
        const flap = document.getElementById('flap');
        const letter = document.getElementById('letter');
        const typedText = document.getElementById('typed-text');

        const windowWidth = window.innerWidth;
        const windowHeight = window.innerHeight;

        const letterContent =
`To. ëª…ì§€ì—ê²Œ

ì•ˆë…•, ëª…ì§€ì•¼!
25ì‚´ ìƒì¼ ë‚´ê°€ ì •ë§ ë§ì´ ì¶•í•˜í•´ğŸ¥³ğŸ¥³ğŸ¥³
ë­”ê°€ ê¸°ì–µì— ë‚¨ì„ë§Œí•œ ì¶•í•˜ë¥¼ í•´ì£¼ê³  ì‹¶ì—ˆëŠ”ë°,
ê·¼ ì—´í˜? ë™ì•ˆ íê¸°ëœ ê²ƒë“¤ë§Œ ì‹­ìˆ˜ê°œì•¼..ã…
ë‚´ê°€ ì›¹ ê°œë°œìë„ ë””ìì´ë„ˆë„ ì•„ë‹ˆë‹¤ë³´ë‹ˆ í•  ìˆœ ìˆëŠ”ë° ì´ë˜ì €ë˜ ë²„ê²ë„¤ğŸ˜­
ê·¸ëƒ¥ ì‹¬í”Œí•˜ê²Œ í•˜ì.. í•´ì„œ ì´ê±¸ë¡œ ë§ˆë¬´ë¦¬........
ì›ë˜ ë¸”ë¡œê·¸ í˜•íƒœë¡œ ì‚¬ì§„ì´ë‚˜ ë…¸ë˜ ë„£ê³  í•˜ë‹¤ê°€ ì–´ë–»ê²Œ ëëŠ”ì§€ ì•Œì•„??
60ëŒ€ ì•„ì €ì”¨ ê°ì„±ë§ˆëƒ¥ ì˜ˆìœ ì‚¬ì§„ ëª‡ê°œ ë„£ê³  'í–‰ë³µí•˜ì„¸ìš”' ëŠë‚Œì´ë¼ í•˜ë‹¤ê°€ íê¸°í–ˆì–´...ã…‹ã…‹
ê²°êµ­ ë§¤ì¼ ìƒˆë²½ì— ì‚½ì§ˆë§Œ ì—„ì²­ í•˜ë‹¤ 'ì°¸ì‹ í•œ í¸ì§€ì§€' ì •ë„ë§Œ ì™„ì„±í•˜ì! í•´ì„œ ì´ë ‡ê²Œë¼ë„ ë³´ë‚´.
ìŒ! ë§ˆìŒê³¼ ì •ì„±ì´ ì¤‘ìš”í•œê±°ì§€ ê·¸ëŸ¼ê·¸ëŸ¼ğŸ˜Š

ê¼­!! ì´ëŸ°ê±° í•˜ë©´ ë” ì˜í•´ì£¼ê³  ì‹¶ì–´ì„œ, ë” ì¢‹ì€ ê²½í—˜ë§Œ ì£¼ê³  ì‹¶ì—ˆëŠ”ë°
ì—´ì‹¬íˆ í•˜ë‹¤ê°€ ë¯¸ë¤„ì§€ê³  ã…  ê²°êµ­ ì²´ë ¥ê´€ë¦¬ ëª»í•´ì„œ ì—°ì°¨ì¼ë‹¤. í—¤í—¤
ëª…ì§€ì™€ì˜ ì¶”ì–µì— í™ì„ ë¿Œë¦¬ê³  ì‹¶ì§€ ì•Šê¸°ì— í•­ìƒ ì¢‹ì€ ê²ƒë“¤ë§Œ í•´ì£¼ê³  ì‹¶ì—ˆì–´.
ê°™ì´ ë§›ë‚œ ê²ƒë„ ë¨¹ê³  ë†€ê³ ë„ ì‹¶ì§€ë§Œ.. ìŒ..ã…
í•˜ê³ í”ˆ ë§ ë§ì€ë° ì´ê²ƒë„ ì¼ë‹¤ ì§€ì› ë‹¤ í•˜ë‹¤ê°€ ê²°êµ­ ì§€ê¸ˆ ì‹œê°„ì´..
18ì¼ ì €ë… 10ì‹œë„¤! ã…‹ã…‹ ì ë‹¤ë³´ë‹ˆ ìˆ˜ì‹­ì¤„ ê·¸ëƒ¥ ë„˜ì–´ê°€ì„œ ì—´ì‹¬íˆ ì¤„ì˜€ì–´.
ì™œ ì¤„ì˜€ëƒê³ ? íš¡ì„¤ìˆ˜ì„¤í•˜ë˜ê²Œ ë§ì•„ì„œ ìˆ˜ì •í•˜ë ¤ëŠ”ë°.. ì•„ë§ˆ í¸ì§€ì§€ ì‘ì—…ì´
11ì‹œ 50ë¶„ ì¯¤ ëë‚  ê²ƒ ê°™ê¸° ë•Œë¬¸ì´ì§€.
ì•„ë¬´íŠ¼! ëª…ì§€ì˜ ë‚  ì¦ê²ê³  ì¬ë¯¸ë‚˜ê²Œ ë³´ë‚´êµ¬! ë§›ë‚œ ê²ƒë„ ë§ì´ ë¨¹êµ¬!!!
í–‰ë³µí•œ í•˜ë£¨ ëìŒ ì¢‹ê² ë„¤

ë‹¤ì‹œ í•œë²ˆ ìƒì¼ ì¶•í•˜í•´

From. ëª…ì§€íŒ¬ 1í˜¸ê°€`;

        let index = 0;

        function typeText() {
            if (index < letterContent.length) {
                typedText.textContent += letterContent.charAt(index);
                index++;

                typedText.parentElement.scrollTop = typedText.parentElement.scrollHeight;

                setTimeout(typeText, 70);
            }
        }


        let sFlag = 0;
        function adjustLetterScale() {
            if (sFlag == 0) return;
            const letter = document.getElementById('letter');
            const letterContent = document.getElementById('letter-content');

            const windowWidth = window.innerWidth;
            const windowHeight = window.innerHeight;

            // ì°¸ì¡° í•´ìƒë„ (Full HD)
            const referenceWidth = 1920;
            const referenceHeight = 500;
            const maxScale = 2.8;
            const minScale = 0.2;

            // í™”ë©´ ë¹„ìœ¨ì— ë”°ë¥¸ ìŠ¤ì¼€ì¼ ê³„ì‚°
            let scale = windowHeight / referenceHeight;
            scale = Math.max(minScale, Math.min(scale, maxScale));

            // í¸ì§€ì— ìŠ¤ì¼€ì¼ ì ìš©
            letter.style.transform = `translate(-50%, -25%) scale(${scale})`;

            // í°íŠ¸ í¬ê¸° ë° íŒ¨ë”© ì¡°ì ˆ
            letterContent.style.fontSize = `${Math.min(1 * scale, 0.6)}em`;
            letterContent.style.padding = `${15}px`;

            // í¸ì§€ì˜ ì‹¤ì œ ë†’ì´ ê³„ì‚°
            const letterHeight = letter.offsetHeight;
            console.log(letterHeight)

            // íŒ¨ë”© ê°’ì„ ê°€ì ¸ì˜¤ê¸°
            const computedStyle = window.getComputedStyle(letterContent);
            const paddingTop = parseFloat(computedStyle.paddingTop);
            const paddingBottom = parseFloat(computedStyle.paddingBottom);

            // ìƒë‹¨ê³¼ í•˜ë‹¨ ì—¬ë°±ì„ ë™ì¼í•˜ê²Œ ìœ ì§€í•˜ê¸° ìœ„í•´ ë‚´ìš© ì˜ì—­ì˜ ìµœëŒ€ ë†’ì´ ê³„ì‚°
            const contentMaxHeight = letterHeight - (paddingTop + paddingBottom);

            // max-height ë™ì  ì„¤ì •
            letterContent.style.maxHeight = `${contentMaxHeight}px`;
        }

        // í™”ë©´ í¬ê¸° ë³€ê²½ ì‹œ ìŠ¤ì¼€ì¼ ì¬ì¡°ì •
        window.addEventListener('resize', adjustLetterScale);

        let flag = 1;
        envelope_container.addEventListener('click', () => {
            if (flag != 1) return;

            flag = 0;
            // ë´‰íˆ¬ ì—´ê¸°
            flap.style.transform = 'rotateX(180deg)';

            setTimeout(() => {
                flap.style.zIndex = '6';

                envelope.style.transform = 'translateY(200%)';
                base_envelope.style.transform = 'translate(-50%, 152%)';
                flap.style.transform = 'translate(0%, 400%)';

                letter.style.transform = 'translate(-50%, -70%)';

                setTimeout(() => {
                    letter.classList.add('open');
                    base_envelope.style.display = 'none';
                    setTimeout(() => {
                        sFlag = 1;
                        adjustLetterScale();

                        envelope.style.opacity = '0';
                        flap.style.opacity = '0';

                        typedText.parentElement.classList.add('visible');
                        typeText();
                    }, 1000);
                }, 700);
            }, 2300);
        });
    </script>
</body>
</html>
